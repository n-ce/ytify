/* MiniPlayer - AAA Compact Now Playing Bar */
.miniplayer {
  display: flex;
  align-items: center;
  width: 100%;
  height: var(--space-2xl);
  padding: var(--space-sm);
  cursor: pointer;
  position: relative;
  background: var(--bg-surface);
  border-top: var(--border-subtle);
  
  /* Entrance animation */
  animation: slide-in-up var(--duration-normal) var(--ease-out-expo) forwards;
  
  /* Smooth transitions */
  transition: background var(--duration-fast) var(--ease-out-quart);
}

.miniplayer:hover {
  background: var(--bg-tertiary);
}

.miniplayer:active {
  transform: scale(0.995);
}

/* Vinyl-style thumbnail */
.miniplayer img {
  height: 44px;
  width: 44px;
  object-fit: cover;
  border: var(--border-subtle);
  border-radius: 50%;
  box-shadow: var(--shadow-sm);
  pointer-events: none;
  transition: 
    box-shadow var(--duration-fast) var(--ease-out-quart),
    transform 0.1s linear;
}

.miniplayer.playing img {
  animation: vinyl-spin 4s linear infinite;
  box-shadow: var(--shadow-glow);
}

/* Control buttons */
.miniplayer button,
.miniplayer i {
  background: none;
  border: none;
  color: var(--text-primary);
  font-size: var(--font-size-lg);
  aspect-ratio: 1;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  margin: 0 var(--space-xs);
  border-radius: var(--radius-full);
  transition: 
    transform var(--duration-fast) var(--ease-spring),
    background var(--duration-fast) var(--ease-out-quart);

  &:hover {
    background: var(--bg-tertiary);
  }

  &:active {
    transform: scale(0.85);
  }
}

#playButton {
  font-size: var(--font-size-xl);
  margin: 0 var(--space-sm);
  color: var(--accent-primary);
}

.ri-heart-line,
.ri-heart-fill {
  font-size: var(--font-size-lg);
}

.ri-heart-fill {
  color: var(--accent-live);
}

/* Track info */
.miniplayer .mediaDetails {
  flex: 1;
  overflow: hidden;
  pointer-events: none;
  margin-left: var(--space-md);
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 2px;

  a {
    font-weight: 600;
    font-size: var(--font-size-sm);
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-decoration: none;
  }

  p {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: 0;
  }
}

/* Progress bar with glow */
.miniplayer progress {
  position: absolute;
  z-index: -1;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: transparent;
  -webkit-appearance: none;
  appearance: none;

  &::-webkit-progress-bar {
    background: transparent;
  }

  &::-webkit-progress-value {
    background: linear-gradient(
      to bottom,
      transparent 0%,
      oklch(from var(--accent-primary) 20% 0.05 h / 30%) 100%
    );
    border-bottom: 2px solid var(--accent-primary);
    box-shadow: 0 -4px 12px oklch(from var(--accent-primary) l c h / 20%);
    transition: all 1s linear;
  }
  
  &::-moz-progress-bar {
    background: linear-gradient(
      to bottom,
      transparent 0%,
      oklch(from var(--accent-primary) 20% 0.05 h / 30%) 100%
    );
    border-bottom: 2px solid var(--accent-primary);
  }
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce) {
  .miniplayer.playing img {
    animation: none !important;
  }
  
  .miniplayer {
    animation: none;
    transition: none;
  }
}

/* ============================================
   RESPONSIVE MINI PLAYER STYLES
   ============================================ */

/* === Mobile Default (< 640px) === */
/* Base styles above are mobile-first */

/* === sm: Small Tablet / Mobile Landscape (≥ 640px) === */
@media (min-width: 640px) {
  .miniplayer {
    /* Slightly taller on larger mobile */
    height: calc(var(--space-2xl) + 8px);
    padding: var(--space-sm) var(--space-md);
  }
  
  .miniplayer img {
    height: 48px;
    width: 48px;
  }
}

/* === md: Tablet Portrait (≥ 768px) === */
@media (min-width: 768px) {
  .miniplayer {
    height: 60px;
    padding: var(--space-sm) var(--space-lg);
  }
  
  .miniplayer img {
    height: 52px;
    width: 52px;
  }
  
  .miniplayer .mediaDetails a {
    font-size: var(--font-size-md);
  }
}

/* === lg: Desktop (≥ 1024px) === */
@media (min-width: 1024px) {
  .miniplayer {
    /* Mini player at bottom of sidebar or content area */
    height: 72px;
    padding: var(--space-md) var(--space-lg);
    border-radius: var(--radius-lg);
    margin: var(--space-sm);
    background: var(--bg-elevated);
    border: var(--border-subtle);
    box-shadow: var(--shadow-md);
  }
  
  .miniplayer img {
    height: 56px;
    width: 56px;
  }
  
  .miniplayer button,
  .miniplayer i {
    width: 44px;
    height: 44px;
  }
  
  #playButton {
    font-size: 28px;
  }
}

/* === TV Mode (≥ 1920px) === */
@media (min-width: 1920px) {
  .miniplayer {
    height: 100px;
    padding: var(--space-lg) var(--space-xl);
    margin: var(--space-md);
  }
  
  .miniplayer img {
    height: 72px;
    width: 72px;
  }
  
  .miniplayer button,
  .miniplayer i {
    width: 64px;
    height: 64px;
    font-size: var(--font-size-xl);
  }
  
  #playButton {
    font-size: 36px;
  }
  
  .miniplayer .mediaDetails a {
    font-size: var(--font-size-lg);
  }
  
  .miniplayer .mediaDetails p {
    font-size: var(--font-size-md);
  }
  
  /* TV Focus State */
  .miniplayer:focus-visible {
    outline: var(--tv-focus-ring);
    transform: scale(1.02);
  }
}

/* === CAR DISPLAY MODE === */
/* Landscape with limited height - car infotainment */
@media (orientation: landscape) and (max-height: 600px) {
  .miniplayer {
    height: 80px;
    padding: var(--space-sm) var(--space-lg);
    background: var(--bg-surface);
    border-radius: 0;
    margin: 0;
  }
  
  .miniplayer img {
    height: 64px;
    width: 64px;
    border-radius: var(--radius-md); /* Square for car */
    animation: none; /* No spinning in car mode */
  }
  
  .miniplayer button,
  .miniplayer i {
    /* Large touch targets for car */
    width: 56px;
    height: 56px;
    min-width: var(--touch-target-car, 72px);
    min-height: var(--touch-target-car, 72px);
  }
  
  #playButton {
    font-size: 32px;
  }
  
  .ri-heart-line,
  .ri-heart-fill {
    display: none; /* Hide like button in car mode */
  }
  
  .miniplayer .mediaDetails {
    margin-left: var(--space-sm);
  }
  
  .miniplayer .mediaDetails a {
    font-size: var(--font-size-md);
  }
  
  .miniplayer .mediaDetails p {
    display: none; /* Hide artist in car mode */
  }
}

/* === Wide Car Displays === */
@media (min-aspect-ratio: 2/1) and (max-height: 800px) {
  .miniplayer {
    height: 90px;
    padding: var(--space-md) var(--space-xl);
  }
  
  .miniplayer img {
    height: 72px;
    width: 72px;
  }
  
  .miniplayer button,
  .miniplayer i {
    width: 64px;
    height: 64px;
  }
}

/* === Touch Devices (coarse pointer) === */
@media (hover: none) and (pointer: coarse) {
  .miniplayer button,
  .miniplayer i {
    /* Ensure minimum touch target */
    min-width: var(--touch-target-min, 44px);
    min-height: var(--touch-target-min, 44px);
  }
  
  .miniplayer:hover {
    background: var(--bg-surface); /* No hover effect on touch */
  }
  
  .miniplayer:active {
    background: var(--bg-tertiary);
  }
}

/* === Mouse/Trackpad Devices === */
@media (hover: hover) and (pointer: fine) {
  .miniplayer button:hover,
  .miniplayer i:hover {
    background: var(--bg-elevated);
  }
}

/* ============================================
   DEVICE-SPECIFIC CLASS OVERRIDES
   ============================================ */

/* Mobile device */
.device-mobile .miniplayer {
  /* Standard mobile mini player */
  height: var(--space-2xl);
}

/* Car devices */
.device-car .miniplayer,
.device-carplay .miniplayer,
.device-android-auto .miniplayer {
  height: 80px;
  background: var(--bg-surface);
}

.device-car .miniplayer img,
.device-carplay .miniplayer img,
.device-android-auto .miniplayer img {
  border-radius: var(--radius-md);
  animation: none;
}

.device-car .miniplayer button,
.device-carplay .miniplayer button,
.device-android-auto .miniplayer button,
.device-car .miniplayer i,
.device-carplay .miniplayer i,
.device-android-auto .miniplayer i {
  min-width: var(--touch-target-car, 72px);
  min-height: var(--touch-target-car, 72px);
}

/* Hide non-essential controls in car mode */
.device-car .ri-heart-line,
.device-carplay .ri-heart-line,
.device-android-auto .ri-heart-line,
.device-car .ri-heart-fill,
.device-carplay .ri-heart-fill,
.device-android-auto .ri-heart-fill {
  display: none;
}

/* TV device */
.device-tv .miniplayer {
  height: 100px;
  padding: var(--space-lg);
}

.device-tv .miniplayer:focus-visible {
  outline: var(--tv-focus-ring);
  transform: scale(1.02);
}