@import './slider.css';

/* === PLAYER SECTION - Responsive Wrapper === */
#playerSection {
  display: flex;
  flex-direction: column;
  position: fixed;
  z-index: var(--z-player);
  background: var(--bg-base);
  
  /* Defaults (Mobile) */
  inset: 0;
  width: 100%;
  height: 100%; /* Full screen modal on mobile */
  transform: translateY(100%); /* Hidden by default */
  transition: transform var(--duration-normal) var(--ease-out-quart);
  overflow-y: auto;
  overflow-x: hidden;

  /* When active */
  &.active {
    transform: translateY(0);
  }

  & * {
    z-index: 2;
  }

  & div.bg-pane {
    background: oklch(from var(--accent-primary) 12% 0.03 h / 85%);
    -webkit-backdrop-filter: blur(40px);
    backdrop-filter: blur(40px);
    z-index: 1;
    position: absolute;
    inset: 0;
  }

  & div.bg-image {
    position: absolute;
    inset: 0;
    background-image: var(--player-bg);
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-size: cover;
    background-position: center;
    transition: background-image var(--duration-slow) var(--ease-out-quart);
    z-index: 0;
    filter: saturate(1.2);
  }

  header {
    z-index: 3;
    padding: var(--space-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .ri-more-2-fill {
    padding: var(--space-sm);
    cursor: pointer;
    border-radius: var(--radius-full);
    transition: background var(--duration-fast) var(--ease-out-quart);
    
    &:hover {
      background: var(--bg-overlay);
    }
  }

  /* === DESKTOP SIDEBAR === */
  @media (min-width: 1024px) {
    left: auto;
    right: 0;
    top: 0;
    bottom: 0;
    width: 420px; /* Fixed width sidebar */
    transform: translateX(0); /* Always visible on desktop if intended */
    border-left: var(--border-subtle);
    box-shadow: var(--shadow-xl);
    
    & div.bg-image {
      border-top-left-radius: 0;
    }
    
    /* If we want it collapsible on desktop, use a class */
    &.collapsed {
      transform: translateX(100%);
    }
  }
}

#playerSection article {
  display: flex;
  flex-direction: column;
  justify-content: flex-end; /* Bottom alignment for ease of reach */
  width: 100%;
  flex: 1;
  padding: var(--space-lg);
  margin: 0 auto;
  max-width: 600px; /* Constraint on large tablets */

  button {
    background: none;
    border: none;
    cursor: pointer;
  }

  i, button, label {
    font-size: var(--font-size-lg);
    transition: 
      transform var(--duration-fast) var(--ease-spring),
      color var(--duration-fast) var(--ease-out-quart);
  }

  /* Vinyl-style album artwork */
  img {
    margin: 0 auto auto auto; /* Push to center-top */
    border-radius: 50%;
    box-shadow: var(--shadow-depth);
    width: min(70vw, 320px);
    aspect-ratio: 1;
    object-fit: cover;
    animation: vinyl-spin 8s linear infinite;
    animation-play-state: var(--vinyl-state, paused);
    transition: box-shadow var(--duration-normal) var(--ease-out-quart);
    will-change: transform;
  }

  img.playing {
    --vinyl-state: running;
    box-shadow: var(--shadow-glow), var(--shadow-depth);
  }

  /* Mobile Landscape */
  @media (orientation: landscape) and (max-width: 1023px) {
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: var(--space-lg);
    padding: var(--space-md);
    
    img {
      margin: 0;
      width: min(40vh, 200px);
    }
    
    .player-controls-container {
      flex: 1;
      max-width: 400px;
    }
  }

  &:has(>div.watcher) {
    margin: auto;
    justify-content: center;
  }
}

.mediaDetails {
  margin: var(--space-lg) 0;
  text-align: left; /* Ergonomic for thumb */

  a {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-size: var(--font-size-xl);
    font-weight: 800;
    color: var(--text-primary);
    text-decoration: none;
    line-height: var(--line-height-tight);
    letter-spacing: -0.5px;
  }

  p {
    display: block;
    font-size: var(--font-size-md);
    color: var(--text-secondary);
    margin-top: var(--space-xs);
    font-weight: 500;
  }
}

.slider {
  margin-bottom: var(--space-md);
  
  input {
    width: 100%;
    color: var(--accent-primary);
    height: 6px;
    transition: height var(--duration-fast);
    
    &:hover {
      height: 10px;
    }
  }

  div {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;

    p {
      font-size: var(--font-size-xs);
      color: var(--text-muted);
      font-variant-numeric: tabular-nums;
      font-weight: 500;
    }
  }
}

.topShelf {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-sm);

  > p {
    font-size: var(--font-size-xs);
    color: var(--accent-primary);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
  }

  .right-group {
    display: flex;
    gap: var(--space-sm);
    
    i {
      padding: var(--space-sm);
      border-radius: var(--radius-md);
      
      &:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }
    }
  }
}

.mainShelf {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: var(--space-md) 0;
  padding: 0 var(--space-sm);

  button, i {
    padding: var(--space-md);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    
    &:hover {
      background: var(--bg-tertiary);
    }
    
    &:active {
      transform: scale(0.9);
    }
  }
  
  /* Skip Buttons */
  i.ri-skip-back-fill, i.ri-skip-forward-fill {
    font-size: 32px;
  }

  #playButton {
    width: 72px;
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent-primary);
    color: var(--bg-base);
    border-radius: var(--radius-full);
    font-size: 32px;
    box-shadow: var(--shadow-glow);
    transition: 
      transform var(--duration-fast) var(--ease-spring),
      box-shadow var(--duration-fast) var(--ease-out-quart);
    
    &:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-glow-intense);
    }
    &:active {
      transform: scale(0.95);
    }
  }
}

.bottomShelf {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: var(--space-md);
  margin-bottom: var(--space-xl); /* Space for home indicator */
  padding: 0 var(--space-sm);

  i {
    font-size: var(--font-size-md) !important;
    padding: var(--space-sm);
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    
    &:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }
    
    &.on {
      color: var(--accent-primary);
      background: oklch(from var(--accent-primary) l c h / 15%);
    }
  }
}

/* === TV MODE === */
@media (min-width: 1921px) {
  #playerSection {
    left: 120px; /* Sidebar width */
    width: calc(100% - 120px);
    flex-direction: row;
    padding: var(--tv-safe-area);
  }
  
  #playerSection article {
    flex-direction: row;
    max-width: none;
    align-items: center;
    gap: var(--space-3xl);
    
    img {
      width: 400px;
      margin: 0;
      box-shadow: var(--shadow-xl);
    }
  }
  
  .player-controls-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  
  .mediaDetails a {
    font-size: 48px;
  }
  
  .mainShelf {
    justify-content: flex-start;
    gap: var(--space-xl);
    
    button:focus-visible {
      outline: var(--tv-focus-ring);
      background: var(--bg-elevated);
    }
  }
}

/* === CAR MODE (Simplified) === */
@media (max-width: 1023px) and (orientation: landscape) and (hover: none) {
  /* Heuristic for Car/Horizontal Phone Mount */
  #playerSection {
    padding: var(--space-sm);
  }
  
  .bottomShelf, .topShelf {
    display: none; /* Hide non-essentials */
  }
  
  .mainShelf {
    justify-content: space-around;
  }
  
  #playButton {
    width: 80px;
    height: 80px;
  }
}

/* Karaoke-style lyrics */
.lyrics {
  aspect-ratio: 1;
  background: var(--bg-surface);
  border-radius: var(--radius-xl);
  padding: var(--space-lg);
  overflow-y: auto;
  overflow-x: hidden;
  border: var(--border-subtle);
  box-shadow: var(--shadow-inset);

  p {
    margin: var(--space-lg) 0;
    font-size: var(--font-size-lg);
    color: var(--text-muted);
    line-height: var(--line-height-relaxed);
    transition: 
      color var(--duration-normal) var(--ease-out-quart),
      transform var(--duration-normal) var(--ease-out-expo),
      text-shadow var(--duration-normal) var(--ease-out-quart);

    &.active {
      font-weight: 700;
      color: var(--text-primary);
      transform: scale(1.05);
      text-shadow: 0 0 20px oklch(from var(--accent-primary) l c h / 40%);
    }
  }
}

.watcher {
  video {
    width: 100%;
    aspect-ratio: 16/9;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
  }

  select {
    font-size: var(--font-size-sm) !important;
    width: 50%;
    text-align: center;
    appearance: none;
    background: var(--bg-surface);
    border: var(--border-subtle);
    border-radius: var(--radius-md);
    padding: var(--space-sm);
    color: var(--text-primary);
  }

  button {
    font-size: var(--font-size-sm) !important;
    width: 50%;
    padding: var(--space-sm);
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    
    &:hover {
      background: var(--bg-active);
    }
    
    &:active {
      transform: scale(0.95);
    }
  }

  p {
    font-size: var(--font-size-xs) !important;
    font-style: italic;
    color: var(--text-muted);
  }
}

/* ============================================
   ENHANCED RESPONSIVE PLAYER STYLES
   ============================================ */

/* === sm: Small Tablet / Mobile Landscape (≥ 640px) === */
@media (min-width: 640px) {
  #playerSection article {
    padding: var(--space-xl);
    max-width: 480px;
  }
  
  #playerSection article img {
    width: min(60vw, 300px);
  }
}

/* === md: Tablet Portrait (≥ 768px) === */
@media (min-width: 768px) {
  #playerSection article {
    padding: var(--space-xl);
    max-width: 540px;
  }
  
  #playerSection article img {
    width: min(50vw, 340px);
  }
  
  .mainShelf {
    #playButton {
      width: 80px;
      height: 80px;
      font-size: 36px;
    }
    
    i.ri-skip-back-fill, i.ri-skip-forward-fill {
      font-size: 36px;
    }
  }
}

/* === Touch Devices (coarse pointer) === */
@media (hover: none) and (pointer: coarse) {
  .mainShelf button,
  .mainShelf i,
  .bottomShelf i,
  .topShelf i {
    /* Ensure minimum touch targets */
    min-width: var(--touch-target-min, 44px);
    min-height: var(--touch-target-min, 44px);
  }
  
  .mainShelf #playButton {
    /* Larger play button for touch */
    min-width: 72px;
    min-height: 72px;
  }
}

/* === Mouse/Trackpad Devices === */
@media (hover: hover) and (pointer: fine) {
  .mainShelf button:hover,
  .bottomShelf i:hover,
  .topShelf i:hover {
    background: var(--bg-tertiary);
  }
}

/* === Full Car Mode - Safety-First Player === */
@media (orientation: landscape) and (max-height: 700px) and (hover: none) {
  #playerSection {
    padding: var(--space-sm);
  }
  
  #playerSection header {
    padding: var(--space-xs) var(--space-md);
    min-height: 48px;
  }
  
  #playerSection article {
    flex-direction: row;
    align-items: center;
    justify-content: center;
    padding: var(--space-md);
    gap: var(--space-lg);
  }
  
  #playerSection article img {
    width: min(35vh, 180px);
    margin: 0;
  }
  
  .player-controls-container {
    flex: 1;
    max-width: 500px;
  }
  
  .mediaDetails {
    margin: var(--space-sm) 0;
    
    a {
      font-size: var(--font-size-lg);
      -webkit-line-clamp: 1;
      line-clamp: 1;
    }
    
    p {
      display: none; /* Hide artist in car mode */
    }
  }
  
  .slider {
    margin-bottom: var(--space-sm);
    
    input {
      height: 12px; /* Thicker for touch */
      
      &:hover {
        height: 16px;
      }
    }
  }
  
  .topShelf {
    display: none; /* Hide non-essential controls */
  }
  
  .bottomShelf {
    display: none; /* Hide non-essential controls */
  }
  
  .mainShelf {
    justify-content: center;
    gap: var(--space-xl);
    padding: 0;
    
    button, i {
      /* Large touch targets for car safety */
      min-width: var(--touch-target-car, 72px);
      min-height: var(--touch-target-car, 72px);
      padding: var(--space-lg);
    }
    
    #playButton {
      width: 88px;
      height: 88px;
      font-size: 40px;
    }
    
    i.ri-skip-back-fill, i.ri-skip-forward-fill {
      font-size: 40px;
    }
  }
}

/* === Wide Car Displays (Ultra-wide aspect ratios) === */
@media (min-aspect-ratio: 2/1) and (max-height: 800px) {
  #playerSection {
    /* Full width layout for wide displays */
    padding: var(--space-md) var(--space-xl);
  }
  
  #playerSection article {
    flex-direction: row;
    max-width: none;
    gap: var(--space-2xl);
  }
  
  #playerSection article img {
    width: min(40vh, 240px);
  }
  
  .mainShelf {
    justify-content: flex-start;
    gap: var(--space-lg);
  }
}

/* === TV Mode Enhancements (≥ 1920px) === */
@media (min-width: 1920px) {
  .mediaDetails p {
    font-size: var(--font-size-lg);
  }
  
  .slider input {
    height: 10px;
    
    &:hover {
      height: 14px;
    }
  }
  
  .slider div p {
    font-size: var(--font-size-md);
  }
  
  .bottomShelf i {
    font-size: var(--font-size-lg) !important;
    padding: var(--space-md);
  }
  
  .topShelf .right-group i {
    padding: var(--space-md);
  }
  
  /* All interactive elements need focus states for TV remote */
  .mainShelf button:focus-visible,
  .mainShelf i:focus-visible,
  .bottomShelf i:focus-visible,
  .topShelf i:focus-visible {
    outline: var(--tv-focus-ring);
    background: var(--bg-elevated);
    transform: scale(1.1);
  }
  
  .lyrics {
    padding: var(--space-xl);
    
    p {
      font-size: var(--font-size-xl);
      margin: var(--space-xl) 0;
    }
  }
}

/* ============================================
   DEVICE-SPECIFIC CLASS OVERRIDES
   ============================================ */

/* Mobile device */
.device-mobile #playerSection {
  /* Full screen modal on mobile */
  width: 100%;
  height: 100%;
}

/* Tablet device */
.device-tablet #playerSection {
  /* Could be side panel or full screen */
}

/* Car devices - simplified, safety-first */
.device-car #playerSection,
.device-carplay #playerSection,
.device-android-auto #playerSection {
  padding: var(--space-sm);
}

.device-car .topShelf,
.device-carplay .topShelf,
.device-android-auto .topShelf,
.device-car .bottomShelf,
.device-carplay .bottomShelf,
.device-android-auto .bottomShelf {
  display: none; /* Hide non-essential controls */
}

.device-car .mainShelf button,
.device-carplay .mainShelf button,
.device-android-auto .mainShelf button,
.device-car .mainShelf i,
.device-carplay .mainShelf i,
.device-android-auto .mainShelf i {
  min-width: var(--touch-target-car, 72px);
  min-height: var(--touch-target-car, 72px);
}

.device-car #playButton,
.device-carplay #playButton,
.device-android-auto #playButton {
  width: 88px;
  height: 88px;
}

.device-car .mediaDetails a,
.device-carplay .mediaDetails a,
.device-android-auto .mediaDetails a {
  -webkit-line-clamp: 1;
  line-clamp: 1;
  font-size: var(--font-size-lg);
}

.device-car .mediaDetails p,
.device-carplay .mediaDetails p,
.device-android-auto .mediaDetails p {
  display: none;
}

/* TV device */
.device-tv #playerSection {
  left: 120px;
  width: calc(100% - 120px);
}

.device-tv #playerSection article {
  flex-direction: row;
}

.device-tv .mainShelf button:focus-visible,
.device-tv .mainShelf i:focus-visible {
  outline: var(--tv-focus-ring);
  transform: scale(1.1);
}

/* === Reduced Motion === */
@media (prefers-reduced-motion: reduce) {
  #playerSection {
    transition: none;
  }
  
  #playerSection article img {
    animation: none;
  }
  
  #playerSection article img.playing {
    animation: none;
    --vinyl-state: paused;
  }
  
  .lyrics p {
    transition: none;
  }
  
  .mainShelf button,
  .mainShelf i {
    transition: none;
  }
}
